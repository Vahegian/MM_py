<style>
    .my-custom-scrollbar {
        position: relative;
        height: 300px;
        overflow: auto;
    }

    .my-custom-scrollbar thead th {
        position: sticky;
        top: 0;
    }

    .table-wrapper-scroll-y {
        display: block;
    }

    .slow .toggle-group {
        transition: left 0.7s;
        -webkit-transition: left 0.7s;
    }
</style>

<div id="binancePairInfo">

    <!-- <span class="badge badge-primary"></span> -->
    <br>
    <div class="card card-body">
        <div class="card-title">

            <h3>
                <p class="text-center">Pair Info</p>
            </h3>
        </div>
        <div class="table-wrapper-scroll-y my-custom-scrollbar ">
            <table class="table table-sm">
                <thead class="thead-dark card-subtitle">
                    <tr id="bPairsTableHead">
                    </tr>
                </thead>

                <tbody id="bPairsTable" class="card-text">
                </tbody>
            </table>
        </div>
        <button id="showAllInfobut" type="button" class="btn btn-secondary btn-lg btn-block">More Info</button>
        <div>
            <br>
            <table class="table table-bordered table-striped mb-0">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">Total Invested</th>
                        <th scope="col">Total Profit</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="tInvested">$1000</td>
                        <td id="tProfit">$10000</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- <input id="showAllInfobut" type="checkbox" checked data-toggle="toggle" data-style="slow"> -->
    <!-- <input  type="checkbox" checked data-toggle="toggle" data-size="mini"> -->





    <script>
        let data = null;
        var pairInfo = [];
        var showAll = false;

        function setID(item, id) {
            item.setAttribute("id", id);
        }

        function makeRowItem(data) {
            var rowItem = document.createElement("td");
            rowItem.setAttribute("scope", "col");
            var text = document.createTextNode(data);
            rowItem.appendChild(text);
            return rowItem;
        }

        function updateTotals(data) {
            var total = parseFloat(data[1]);
            if (data[0] == "totalInvested") {
                var invested = document.getElementById("tInvested");
                invested.innerHTML = '$ ' + (total).toFixed(4);
                invested.style.color = "red";
                if (total > 0) invested.style.color = "green";
            } else {
                var totalprofittext = document.getElementById("tProfit")
                totalprofittext.innerHTML = '$ ' + (total).toFixed(4);
                totalprofittext.style.color = "red";
                if (total > 0) totalprofittext.style.color = "green";
            }
        }

        function makeTableHead(all) {
            var col = document.getElementById("bPairsTableHead");
            col.innerHTML = '';

            var pa = document.createElement("th");
            pa.innerHTML = "Pair";
            var am = document.createElement("th");
            am.innerHTML = "Amount";
            var pr = document.createElement("th");
            pr.innerHTML = "Price";
            var fee = document.createElement("th");
            fee.innerHTML = "Fee";
            var pf = document.createElement("th");
            pf.innerHTML = "Profit";
            var sa = document.createElement("th");
            sa.innerHTML = '';

            if (all) {
                col.appendChild(pa);
                col.appendChild(am);
                col.appendChild(pr);
                col.appendChild(fee);
                col.appendChild(pf);
                col.appendChild(sa);
            } else {
                col.appendChild(pa);
                col.appendChild(pf);
                col.appendChild(sa);
            }
        }

        function makePairInfoRow(id, pairInfo, profit, all = false) {
            makeTableHead(all);
            var row = document.createElement("tr");
            // setID(row, id);
            row.appendChild(makeRowItem(pairInfo[0]));
            if (all) {
                row.appendChild(makeRowItem(pairInfo[1]));
                row.appendChild(makeRowItem('$ ' + pairInfo[2]));
                row.appendChild(makeRowItem('% ' + pairInfo[3]));

            }

            profit = parseFloat(profit).toFixed(4);
            var item = makeRowItem('$ ' + profit);
            if (profit > 0.0) {
                item.style.color = "green";
            } else {
                item.style.color = "red";
            }
            row.appendChild(item);
            var button = makeButton("Remove");
            // button.style.
            var flexCenterDiv = document.createElement("div");
            flexCenterDiv.setAttribute("class", "d-flex justify-content-end");
            flexCenterDiv.appendChild(button);
            row.appendChild(flexCenterDiv);
            button.addEventListener("click", async function () {
                console.log(id);
                var rmoptions = {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify([id])
                };
                var data = await (await fetch('/io/rmbPairInfo', rmoptions)).json();
                alert(data);
            });
            // console.log(row.childNodes.length);
            return row;
        }

        async function populatePairTable() {
            var data = await getUserInfo();
            // console.log(data[0][1]);
            var tableObj = document.getElementById("bPairsTable");
            tableObj.innerHTML = '';
            for (var id in data) {
                if (data[id][0] != "totalInvested" && data[id][0] != "totalProfit") {
                    var row = makePairInfoRow(id, data[id][0], data[id][1], showAll);
                    tableObj.appendChild(row);
                } else {
                    updateTotals(data[id]);
                }
            }
        }

        async function getUserInfo() {
            try {
                // let response = ;
                let data = await (await fetch('/io/gbUserPairInfo')).json();
                // console.log(data);
                return data;
            } catch (Exception) {
                console.log(Exception);
                // clearInterval(btime);
            }
        }

        // const btime = setInterval(getBPrices, 1000);

        // populatePairTable();


        $("#showAllInfobut").click(function () {
            showAll = !showAll;
            // if(!showAll){
            //     $("#showAllInfobut").button('dispose');
            // }else{
            //     $("#showAllInfobut").button('toggle');
            // }

            // remove code here
            // updateProfit(id);
        });

        async function stopBinance() {
            await fetch("/xbinance");
            clearInterval(pairInfoUpdate);
        }

        function updateTables() {
            populatePairTable();

        }

        const pairInfoUpdate = setInterval(updateTables, 2000);
    </script>
</div>