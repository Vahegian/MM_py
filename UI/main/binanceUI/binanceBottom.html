<style>
    .my-custom-scrollbar {
        position: relative;
        height: 300px;
        overflow: auto;
    }

    .my-custom-scrollbar thead th {
        position: sticky;
        top: 0;
    }

    .table-wrapper-scroll-y {
        display: block;
    }
</style>

<br>
<div class="card card-body">
    <div>

        <h3>
            <p class="text-center">Open Orders</p>
        </h3>
    </div>
    <div class="table-wrapper-scroll-y my-custom-scrollbar">
        <table class="table table-sm">
            <thead class="thead-dark">
                <tr id="bTradeTableHead">
                    <th>
                        Order
                    </th>
                    <th>
                        Pair
                    </th>
                    <th>
                        Amount
                    </th>
                    <th>
                        Price
                    </th>
                </tr>
            </thead>

            <tbody id="bTradeTable">
            </tbody>
        </table>
    </div>
</div>
<br>
<div class="card card-body">
    <div>

        <h3>
            <p class="text-center">Wallet</p>
        </h3>
    </div>

    <div class="table-wrapper-scroll-y my-custom-scrollbar">
        <table class="table table-sm">
            <thead class="thead-dark">
                <tr id="bWalletTableHead">
                    <th>
                        Asset
                    </th>
                    <th>
                        Amount
                    </th>
                    <th>
                        onOrder
                    </th>
                </tr>
            </thead>

            <tbody id="bWalletTable">
            </tbody>
        </table>
    </div>
    <br>
</div>
<br>
<div>
    <button id="bAutoTradeBut" type="button" class="btn btn-success btn-lg btn-block">
        Auto Trade</button>
</div>
<br>

<script>
    var autoTradeBut = document.getElementById("bAutoTradeBut");
    var trade = false;

    async function populateOrderTable(orderList) {
        var tableObj = document.getElementById("bTradeTable");
        tableObj.innerHTML = '';
        for (var index in orderList) {
            var row = document.createElement('tr');
            var order = document.createElement('td');
            var text = orderList[index]["side"];
            order.innerHTML = text;
            if (text == "SELL") { order.style.backgroundColor = "red"; }
            else { order.style.backgroundColor = "green" }
            var pair = document.createElement('td');;
            pair.innerHTML = orderList[index]["symbol"];
            var amount = document.createElement('td');
            amount.innerHTML = parseFloat(orderList[index]["origQty"]).toFixed(4);
            var price = document.createElement('td');
            price.innerHTML = parseFloat(orderList[index]["price"]).toFixed(4);

            row.appendChild(order);
            row.appendChild(pair);
            row.appendChild(amount);
            row.appendChild(price);
            tableObj.appendChild(row);
        }
    }

    async function populateWalletTable(walletData) {
        var tableObj = document.getElementById("bWalletTable");
        tableObj.innerHTML = '';
        for (var index in walletData) {
            var row = document.createElement('tr');
            var asset = document.createElement('td');
            asset.innerHTML = walletData[index][0];
            var amount = document.createElement('td');
            amount.innerHTML = parseFloat(walletData[index][1][0]).toFixed(4);
            var onOrder = document.createElement('td');
            onOrder.innerHTML = parseFloat(walletData[index][1][1]).toFixed(4);

            row.appendChild(asset);
            row.appendChild(amount);
            row.appendChild(onOrder);
            tableObj.appendChild(row);
        }
    }

    async function getData(link) {
        try {
            // let response = ;
            let listOfOrders = await (await fetch(link)).json();
            return listOfOrders;
        } catch (Exception) {
            console.log(Exception);
            // clearInterval(btime);
        }
    }

    async function updateOrdersTable() {
        var orderList = await getData('/io/gbOpenOrd');
        populateOrderTable(orderList);
        // var walletmap = await getData('/io/gbWallet');
        // console.log(walletmap);
    }

    updateOrdersTable();

    async function updateWalletTable() {
        var walletData = await getData('/io/gbWallet');
        populateWalletTable(walletData);
        // console.log(walletData);

    }
    updateWalletTable();

    $("#bAutoTradeBut").click(async () => {
        updateWalletTable();
        console.log("tradeButtPressed");
        if (!trade) {
            autoTradeBut.innerHTML = "Stop Trading";
            autoTradeBut.setAttribute("class", "btn btn-danger btn-lg btn-block");
            trade = true;
        } else {

            autoTradeBut.innerHTML = "Auto Trade";
            autoTradeBut.setAttribute("class", "btn btn-success btn-lg btn-block");
            trade = false;
        }
    });
</script>